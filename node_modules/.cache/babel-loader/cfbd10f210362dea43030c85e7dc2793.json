{"ast":null,"code":"import _objectSpread from \"/home/minhtranin/work/treenode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"/home/minhtranin/work/treenode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/home/minhtranin/work/treenode/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/minhtranin/work/treenode/src/Dragable.js\";\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Tree, Input, Select, Button } from 'antd';\nimport { FolderFilled } from \"@ant-design/icons\";\nimport InputAction from './component/InputAction';\nimport { v4 } from 'uuid';\nvar Search = Input.Search;\nvar Option = Select.Option;\n\nvar Folder = function Folder(_ref) {\n  var name = _ref.name,\n      type = _ref.type,\n      handleSelect = _ref.handleSelect;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"g-folder\",\n    onClick: function onClick() {\n      if (typeof handleSelect === 'function') {\n        handleSelect();\n      }\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 10,\n      columnNumber: 12\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 18,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      paddingLeft: \"10px\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 19,\n      columnNumber: 13\n    }\n  }, name)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      paddingLeft: \"10px\",\n      fontSize: \"11px\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 13\n    }\n  }, type === 'all' ? 'Visible to Everyone' : 'Visible to specific users')));\n};\n\nvar treeData = useMemo(function () {\n  return [{\n    title: \"label\",\n    name: 'My folder name 1',\n    allowers: ['lucy'],\n    type: 'one',\n    children: [{\n      title: \"label\",\n      name: 'My folder name 1-1',\n      allowers: [],\n      type: 'all',\n      children: [{\n        title: \"label\",\n        name: 'My folder name 1-1-1',\n        allowers: [],\n        type: 'all'\n      }]\n    }]\n  }, {\n    title: \"label\",\n    name: 'My folder name 2',\n    allowers: ['lucy'],\n    type: 'one'\n  }];\n}, []);\n\nvar SearchTree = function SearchTree() {\n  var _value$allowers;\n\n  var _useState = useState(undefined),\n      _useState2 = _slicedToArray(_useState, 2),\n      searchValue = _useState2[0],\n      setSearchValue = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      open = _useState4[0],\n      setOpen = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      gData = _useState6[0],\n      setGData = _useState6[1];\n\n  var _useState7 = useState(undefined),\n      _useState8 = _slicedToArray(_useState7, 2),\n      value = _useState8[0],\n      setValue = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      save = _useState10[0],\n      setSave = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      final = _useState12[0],\n      setFinal = _useState12[1];\n\n  var helperFindPosition = useCallback(function (p) {\n    return p.split('-').reduce(function (i, v, idx) {\n      var init = i;\n\n      if (idx >= 1) {\n        init.push(Number(v));\n      }\n\n      return init;\n    }, []);\n  }, []);\n  var helperGetItem = useCallback(function () {\n    var p = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    return p.reduce(function (init, value, idex) {\n      if (idex === 0) {\n        return init[value];\n      } else {\n        var _init$children;\n\n        return init === null || init === void 0 ? void 0 : (_init$children = init.children) === null || _init$children === void 0 ? void 0 : _init$children[value];\n      }\n    }, gData);\n  }, [gData]);\n  var helperDeleteItem = useCallback(function () {\n    var p = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n    var newDataAfterDel = _toConsumableArray(gData);\n\n    p.reduce(function (init, value, idex) {\n      if (idex === 0) {\n        if (p.length === 1) init.splice(value, 1);\n        return init[value];\n      } else if (idex === p.length - 1) {\n        init.children.splice(value, 1);\n        return init.children;\n      } else {\n        var _init$children2;\n\n        return init === null || init === void 0 ? void 0 : (_init$children2 = init.children) === null || _init$children2 === void 0 ? void 0 : _init$children2[value];\n      }\n    }, newDataAfterDel);\n    return newDataAfterDel;\n  }, [gData]);\n  var helperSaveItem = useCallback(function () {\n    var p = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var params = arguments.length > 1 ? arguments[1] : undefined;\n    var name = params.name,\n        type = params.type,\n        allowers = params.allowers;\n\n    var newDataAfterDel = _toConsumableArray(gData);\n\n    p.reduce(function (init, value, idex) {\n      if (idex === 0) {\n        if (p.length === 1) {\n          init[value].title = 'label';\n          init[value].name = name;\n          init[value].type = type;\n          init[value].allowers = allowers;\n        }\n\n        return init[value];\n      } else if (idex === p.length - 1) {\n        var _init$children3;\n\n        init.children[value].title = 'label';\n        init.children[value].name = name;\n        init.children[value].type = type;\n        init.children[value].allowers = allowers;\n        return init === null || init === void 0 ? void 0 : (_init$children3 = init.children) === null || _init$children3 === void 0 ? void 0 : _init$children3[value];\n      } else {\n        var _init$children4;\n\n        return init === null || init === void 0 ? void 0 : (_init$children4 = init.children) === null || _init$children4 === void 0 ? void 0 : _init$children4[value];\n      }\n    }, newDataAfterDel);\n    return newDataAfterDel;\n  }, [gData]);\n  var handleSelectTree = useCallback(function (p) {\n    setOpen(false);\n    setSave(false);\n    var position = helperFindPosition(p);\n    var info = helperGetItem(position);\n    setValue({\n      value: info.name,\n      label: info.name,\n      type: info.type,\n      allowers: info.allowers\n    });\n  }, [helperFindPosition, helperGetItem]);\n  var makeup = useCallback(function (d) {\n    var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '0';\n    var result = d.map(function (node, parentIdx) {\n      var type = node.type,\n          allowers = node.allowers,\n          name = node.name,\n          children = node.children,\n          title = node.title;\n      var newTitle = title;\n      var newChildren = children;\n\n      if (children) {\n        newChildren = makeup(children, \"\".concat(level, \"-\").concat(parentIdx));\n      }\n\n      return _objectSpread({\n        title: newTitle,\n        key: \"\".concat(level, \"-\").concat(parentIdx),\n        name: name,\n        allowers: allowers,\n        type: type,\n        icon: /*#__PURE__*/React.createElement(FolderFilled, {\n          style: {\n            fontSize: \"20px\",\n            paddingTop: \"10px\"\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 23\n          }\n        })\n      }, children ? {\n        children: newChildren\n      } : {});\n    });\n    return result;\n  }, []);\n\n  var _handleDel = useCallback(function (p) {\n    var position = helperFindPosition(p);\n    var newDataAfterDel = helperDeleteItem(position);\n    setGData(_toConsumableArray(makeup(newDataAfterDel)));\n  }, [helperFindPosition, helperDeleteItem, makeup]);\n\n  var handleSav = useCallback(function (params, p) {\n    if (!params) return;\n    var position = helperFindPosition(p);\n    var newDataAfterDel = helperSaveItem(position, params);\n    console.log(newDataAfterDel, params);\n    setGData(_toConsumableArray(makeup(newDataAfterDel)));\n  }, [helperFindPosition, helperSaveItem, makeup]);\n  useEffect(function () {\n    var newestData = makeup(treeData);\n    setGData(newestData);\n  }, [makeup]);\n  useEffect(function () {\n    if (gData) {\n      var afterMakeUp = function afterMakeUp(freshData) {\n        return freshData.map(function (fd) {\n          var title = fd.title,\n              children = fd.children,\n              key = fd.key,\n              allowers = fd.allowers,\n              name = fd.name,\n              type = fd.type;\n          var newChildren = '';\n          var newTitle = title;\n\n          if (children) {\n            newChildren = afterMakeUp(children);\n          }\n\n          if (title === 'input') {\n            newTitle = /*#__PURE__*/React.createElement(InputAction, {\n              key: v4(),\n              keyIndex: v4(),\n              type: type,\n              allowers: allowers,\n              handleSave: function handleSave(params) {\n                return handleSav(params, key);\n              },\n              handleDel: function handleDel() {\n                return _handleDel(key);\n              },\n              __self: _this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 36\n              }\n            });\n          }\n\n          if (title === 'label') {\n            newTitle = /*#__PURE__*/React.createElement(Folder, {\n              name: name,\n              type: type,\n              handleSelect: function handleSelect() {\n                return handleSelectTree(key);\n              },\n              __self: _this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 36\n              }\n            });\n          }\n\n          return _objectSpread(_objectSpread(_objectSpread({}, fd), children ? {\n            children: newChildren\n          } : {}), {}, {\n            title: newTitle\n          });\n        });\n      };\n\n      var finalData = afterMakeUp(_toConsumableArray(gData));\n      setFinal(finalData);\n    }\n  }, [gData, _handleDel, handleSelectTree, handleSav]);\n\n  var onDragEnter = function onDragEnter(info) {};\n\n  var onDrop = function onDrop(info) {\n    setValue(undefined);\n    setSearchValue(undefined);\n    setSave(false);\n    var dropKey = info.node.key;\n    var dragKey = info.dragNode.key;\n    var dropPos = info.node.pos.split('-');\n    var dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\n\n    var loop = function loop(data, key, callback) {\n      for (var i = 0; i < data.length; i++) {\n        if (data[i].key === key) {\n          return callback(data[i], i, data);\n        }\n\n        if (data[i].children) {\n          loop(data[i].children, key, callback);\n        }\n      }\n    };\n\n    var data = _toConsumableArray(gData);\n\n    var dragObj;\n    loop(data, dragKey, function (item, index, arr) {\n      arr.splice(index, 1);\n      dragObj = item;\n    });\n\n    if (!info.dropToGap) {\n      loop(data, dropKey, function (item) {\n        item.children = item.children || [];\n        item.children.unshift(dragObj);\n      });\n    } else if ((info.node.props.children || []).length > 0 && info.node.props.expanded && dropPosition === 1) {\n      loop(data, dropKey, function (item) {\n        item.children = item.children || [];\n        item.children.unshift(dragObj);\n      });\n    } else {\n      var ar;\n      var i;\n      loop(data, dropKey, function (item, index, arr) {\n        ar = arr;\n        i = index;\n      });\n\n      if (dropPosition === -1) {\n        ar.splice(i, 0, dragObj);\n      } else {\n        ar.splice(i + 1, 0, dragObj);\n      }\n    }\n\n    setGData(makeup(data));\n  };\n\n  var handleAddFolder = function handleAddFolder() {\n    setSearchValue(undefined);\n\n    var oldData = _toConsumableArray(gData);\n\n    var data = [{\n      title: \"input\",\n      name: '',\n      allowers: [],\n      type: gData.length > 4 ? 'all' : 'one'\n    }].concat(_toConsumableArray(oldData));\n    setGData(makeup(data));\n  };\n\n  var handleSearch = useCallback(function (_ref2) {\n    var target = _ref2.target;\n    if (!target) return;\n    var text = target.value;\n    setSearchValue(text);\n  }, []);\n  var filter = useCallback(function (rawData) {\n    if (!searchValue) return rawData;\n\n    var filterFunc = function filterFunc(data) {\n      return data.filter(function (node) {\n        var name = node.name,\n            children = node.children;\n\n        if (name.toLowerCase().indexOf(searchValue.toLowerCase()) !== -1) {\n          console.log('+++');\n          return true;\n        } else if (children) {\n          if (filterFunc(children).length) {\n            return true;\n          }\n        }\n\n        return false;\n      });\n    };\n\n    return filterFunc(rawData);\n  }, [searchValue]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"460px\",\n      margin: '30px auto',\n      border: '1px solid #ded7d7',\n      padding: '5px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    labelInValue: true,\n    open: open,\n    style: {\n      width: 448\n    },\n    onClick: function onClick(e) {\n      var className = e.target.className;\n      var targetClass = ['ant-select-selection-search-input'];\n\n      if (targetClass.includes(className)) {\n        setOpen(!open);\n      }\n    },\n    dropdownStyle: {\n      overflow: 'auto',\n      height: '460px'\n    },\n    value: value,\n    placeholder: \"Please select\",\n    dropdownRender: function dropdownRender(menu) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        style: {},\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 32\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"g-search-header\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Search, {\n        placeholder: \"Search\",\n        style: {\n          width: '269px'\n        },\n        value: searchValue,\n        onChange: function onChange(ev) {\n          return handleSearch(ev);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 33\n        }\n      }), /*#__PURE__*/React.createElement(Button, {\n        onClick: handleAddFolder,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 33\n        }\n      }, \"Add New Folder\")), /*#__PURE__*/React.createElement(Tree, {\n        className: \"draggable-tree\",\n        defaultExpandAll: true,\n        draggable: true,\n        showIcon: true,\n        blockNode: true,\n        onDragEnter: onDragEnter,\n        onDrop: onDrop,\n        treeData: filter(final),\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 368,\n          columnNumber: 29\n        }\n      }));\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Option, {\n    value: \"lucy\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 21\n    }\n  }, \"Lucy (101)\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"g-action-parent\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: function onClick() {\n      setValue(undefined);\n      setSearchValue(undefined);\n      setSave(false);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 21\n    }\n  }, \"Cancel\"), /*#__PURE__*/React.createElement(Button, {\n    disabled: !value,\n    onClick: function onClick() {\n      return setSave(true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 21\n    }\n  }, \"Save\"))), save && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: \"460px\",\n      margin: '30px auto',\n      border: '1px solid #ded7d7',\n      padding: '5px'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 22\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 17\n    }\n  }, \"Folder info\"), /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 21\n    }\n  }, value.label), /*#__PURE__*/React.createElement(\"br\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 21\n    }\n  }, value.type === 'all' ? 'Visible to Everyone' : 'Visible to specific users'), /*#__PURE__*/React.createElement(\"br\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 21\n    }\n  }, !!(value === null || value === void 0 ? void 0 : (_value$allowers = value.allowers) === null || _value$allowers === void 0 ? void 0 : _value$allowers.length) && \"Visible to \".concat(value.allowers.toString())))));\n};\n\nexport default SearchTree;","map":{"version":3,"sources":["/home/minhtranin/work/treenode/src/Dragable.js"],"names":["React","useCallback","useEffect","useMemo","useState","Tree","Input","Select","Button","FolderFilled","InputAction","v4","Search","Option","Folder","name","type","handleSelect","paddingLeft","fontSize","treeData","title","allowers","children","SearchTree","undefined","searchValue","setSearchValue","open","setOpen","gData","setGData","value","setValue","save","setSave","final","setFinal","helperFindPosition","p","split","reduce","i","v","idx","init","push","Number","helperGetItem","idex","helperDeleteItem","newDataAfterDel","length","splice","helperSaveItem","params","handleSelectTree","position","info","label","makeup","d","level","result","map","node","parentIdx","newTitle","newChildren","key","icon","paddingTop","handleDel","handleSav","console","log","newestData","afterMakeUp","freshData","fd","finalData","onDragEnter","onDrop","dropKey","dragKey","dragNode","dropPos","pos","dropPosition","loop","data","callback","dragObj","item","index","arr","dropToGap","unshift","props","expanded","ar","handleAddFolder","oldData","handleSearch","target","text","filter","rawData","filterFunc","toLowerCase","indexOf","width","margin","border","padding","e","className","targetClass","includes","overflow","height","menu","ev","toString"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport { Tree, Input, Select, Button } from 'antd';\nimport { FolderFilled } from \"@ant-design/icons\";\nimport InputAction from './component/InputAction'\nimport { v4 } from 'uuid'\nconst { Search } = Input;\nconst { Option } = Select;\n\nconst Folder = ({ name, type, handleSelect }) => {\n    return <div\n        className=\"g-folder\"\n        onClick={() => {\n            if (typeof handleSelect === 'function') {\n                handleSelect()\n            }\n        }}\n    >\n        <div>\n            <span style={{ paddingLeft: \"10px\" }}>\n                {name}\n            </span>\n        </div>\n        <div>\n            <span style={{\n                paddingLeft: \"10px\", fontSize: \"11px\"\n            }}>\n                {type === 'all' ? 'Visible to Everyone' : 'Visible to specific users'}\n            </span>\n\n        </div>\n    </div>\n}\n\nconst treeData = useMemo(() => {\n    return [\n        {\n            title: \"label\",\n            name: 'My folder name 1',\n            allowers: ['lucy'],\n            type: 'one',\n            children: [\n                {\n                    title: \"label\",\n                    name: 'My folder name 1-1',\n                    allowers: [],\n                    type: 'all',\n                    children: [\n                        {\n                            title: \"label\",\n                            name: 'My folder name 1-1-1',\n                            allowers: [],\n                            type: 'all',\n                        },\n                    ]\n                },\n            ],\n        },\n        {\n            title: \"label\",\n            name: 'My folder name 2',\n            allowers: ['lucy'],\n            type: 'one',\n        },\n    ]\n}, []) \n\nconst SearchTree = () => {\n    const [searchValue, setSearchValue] = useState(undefined)\n    const [open, setOpen] = useState(false)\n    const [gData, setGData] = useState([])\n    const [value, setValue] = useState(undefined)\n    const [save, setSave] = useState(false)\n    const [final, setFinal] = useState([])\n\n    const helperFindPosition = useCallback((p) => {\n        return p.split('-').reduce((i, v, idx) => {\n            const init = i\n            if (idx >= 1) {\n                init.push(Number(v))\n            }\n            return init\n        }, [])\n    }, [])\n\n    const helperGetItem = useCallback((p = []) => {\n        return p.reduce((init, value, idex) => {\n            if (idex === 0) {\n                return init[value]\n            } else {\n                return init?.children?.[value]\n            }\n        }, gData)\n    }, [gData])\n\n    const helperDeleteItem = useCallback((p = []) => {\n        const newDataAfterDel = [...gData]\n        p.reduce((init, value, idex) => {\n            if (idex === 0) {\n                if (p.length === 1) init.splice(value, 1)\n                return init[value]\n            } else if (idex === (p.length - 1)) {\n                init.children.splice(value, 1)\n                return init.children\n            } else {\n                return init?.children?.[value]\n            }\n        }, newDataAfterDel)\n        return newDataAfterDel\n    }, [gData])\n\n    const helperSaveItem = useCallback((p = [], params) => {\n        const { name, type, allowers } = params\n        const newDataAfterDel = [...gData]\n        p.reduce((init, value, idex) => {\n            if (idex === 0) {\n                if (p.length === 1) {\n                    init[value].title = 'label'\n                    init[value].name = name\n                    init[value].type = type\n                    init[value].allowers = allowers\n                }\n                return init[value]\n            } else if (idex === (p.length - 1)) {\n                init.children[value].title = 'label'\n                init.children[value].name = name\n                init.children[value].type = type\n                init.children[value].allowers = allowers\n                return init?.children?.[value]\n            } else {\n                return init?.children?.[value]\n            }\n        }, newDataAfterDel)\n        return newDataAfterDel\n    }, [gData])\n\n    const handleSelectTree = useCallback(((p) => {\n        setOpen(false)\n        setSave(false)\n        const position = helperFindPosition(p)\n        const info = helperGetItem(position)\n        setValue({\n            value: info.name,\n            label: info.name,\n            type: info.type,\n            allowers: info.allowers\n        })\n    }), [helperFindPosition, helperGetItem])\n\n    const makeup = useCallback((d, level = '0') => {\n        const result = d.map((node, parentIdx) => {\n            const { type, allowers, name, children, title } = node\n            let newTitle = title\n            let newChildren = children\n            if (children) {\n                newChildren = makeup(children, `${level}-${parentIdx}`)\n            }\n            return {\n                title: newTitle,\n                key: `${level}-${parentIdx}`,\n                name,\n                allowers,\n                type,\n                icon: <FolderFilled style={{ fontSize: \"20px\", paddingTop: \"10px\" }} />,\n                ...children ? {\n                    children: newChildren,\n                } : {}\n            }\n        })\n        return result\n    }, [])\n\n    const handleDel = useCallback((p) => {\n        const position = helperFindPosition(p)\n        const newDataAfterDel = helperDeleteItem(position)\n        setGData([...makeup(newDataAfterDel)])\n\n    }, [helperFindPosition, helperDeleteItem, makeup])\n\n    const handleSav = useCallback((params, p) => {\n        if (!params) return\n        const position = helperFindPosition(p)\n        const newDataAfterDel = helperSaveItem(position, params)\n        console.log(newDataAfterDel, params)\n        setGData([...makeup(newDataAfterDel)])\n\n    }, [helperFindPosition, helperSaveItem, makeup])\n\n    useEffect(() => {\n        const newestData = makeup(treeData)\n        setGData(newestData)\n    }, [makeup])\n\n    useEffect(() => {\n        if (gData) {\n            const afterMakeUp = (freshData) => {\n                return freshData.map((fd) => {\n                    const { title, children, key, allowers, name, type } = fd\n                    let newChildren = ''\n                    let newTitle = title\n                    if (children) {\n                        newChildren = afterMakeUp(children)\n                    }\n                    if (title === 'input') {\n                        newTitle = <InputAction\n                            key={v4()}\n                            keyIndex={v4()}\n                            type={type}\n                            allowers={allowers}\n                            handleSave={(params) => handleSav(params, key)}\n                            handleDel={() => handleDel(key)}\n                        />\n                    }\n                    if (title === 'label') {\n                        newTitle = <Folder name={name} type={type} handleSelect={() => handleSelectTree(key)} />\n                    }\n                    return {\n                        ...fd,\n                        ...children ? {\n                            children: newChildren,\n                        } : {},\n                        title: newTitle\n                    }\n                })\n            }\n            const finalData = afterMakeUp([...gData])\n            setFinal(finalData)\n        }\n    }, [gData, handleDel, handleSelectTree, handleSav])\n\n    const onDragEnter = info => {\n    };\n\n    const onDrop = info => {\n        setValue(undefined)\n        setSearchValue(undefined)\n        setSave(false)\n        const dropKey = info.node.key;\n        const dragKey = info.dragNode.key;\n        const dropPos = info.node.pos.split('-');\n        const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\n\n        const loop = (data, key, callback) => {\n            for (let i = 0; i < data.length; i++) {\n                if (data[i].key === key) {\n                    return callback(data[i], i, data);\n                }\n                if (data[i].children) {\n                    loop(data[i].children, key, callback);\n                }\n            }\n        };\n        const data = [...gData];\n\n        let dragObj;\n        loop(data, dragKey, (item, index, arr) => {\n            arr.splice(index, 1);\n            dragObj = item;\n        });\n\n        if (!info.dropToGap) {\n            loop(data, dropKey, item => {\n                item.children = item.children || [];\n                item.children.unshift(dragObj);\n            });\n        } else if (\n            (info.node.props.children || []).length > 0 &&\n            info.node.props.expanded &&\n            dropPosition === 1\n        ) {\n            loop(data, dropKey, item => {\n                item.children = item.children || [];\n                item.children.unshift(dragObj);\n            });\n        } else {\n            let ar;\n            let i;\n            loop(data, dropKey, (item, index, arr) => {\n                ar = arr;\n                i = index;\n            });\n            if (dropPosition === -1) {\n                ar.splice(i, 0, dragObj);\n            } else {\n                ar.splice(i + 1, 0, dragObj);\n            }\n        }\n        setGData(makeup(data))\n    };\n\n    const handleAddFolder = () => {\n        setSearchValue(undefined)\n        const oldData = [...gData]\n        const data = [\n            {\n                title: \"input\",\n                name: '',\n                allowers: [],\n                type: gData.length > 4 ? 'all' : 'one',\n            },\n            ...oldData\n        ];\n        setGData(makeup(data))\n    }\n\n    const handleSearch = useCallback(({ target }) => {\n        if (!target) return\n        const text = target.value\n        setSearchValue(text)\n    }, [])\n\n    const filter = useCallback((rawData) => {\n        if (!searchValue) return rawData\n        const filterFunc = (data) => {\n            return data.filter((node) => {\n                const { name, children } = node\n                if (name.toLowerCase().indexOf(searchValue.toLowerCase()) !== -1) {\n                    console.log('+++')\n                    return true\n                } else if (children) {\n                    if (filterFunc(children).length) {\n                        return true\n                    }\n                }\n                return false\n            })\n        }\n        return (filterFunc(rawData))\n    }, [searchValue])\n\n    return (\n        <>\n            <div style={{ width: \"460px\", margin: '30px auto', border: '1px solid #ded7d7', padding: '5px' }}>\n                <Select\n                    labelInValue\n                    open={open}\n                    style={{ width: 448 }}\n                    onClick={(e) => {\n                        const { className } = e.target\n                        const targetClass = ['ant-select-selection-search-input']\n                        if (targetClass.includes(className)) {\n                            setOpen(!open)\n                        }\n                    }}\n                    dropdownStyle={{\n                        overflow: 'auto',\n                        height: '460px',\n                    }}\n                    value={value}\n                    placeholder=\"Please select\"\n                    dropdownRender={(menu) => {\n                        return <div\n                            style={{\n                            }}\n                        >\n                            <div className=\"g-search-header\">\n                                <Search\n                                    placeholder=\"Search\"\n                                    style={{ width: '269px' }}\n                                    value={searchValue}\n                                    onChange={(ev) => handleSearch(ev)}\n                                />\n                                <Button\n                                    onClick={handleAddFolder}\n                                >\n                                    Add New Folder\n                                </Button>\n                            </div>\n                            <Tree\n                                className=\"draggable-tree\"\n                                defaultExpandAll\n                                draggable\n                                showIcon\n                                blockNode\n                                onDragEnter={onDragEnter}\n                                onDrop={onDrop}\n                                treeData={filter(final)}\n                            />\n                            {/* {menu} */}\n                        </div>\n                    }}\n                >\n                    <Option value=\"lucy\">Lucy (101)</Option>\n                </Select>\n                <div className=\"g-action-parent\">\n                    <Button\n                        onClick={() => {\n                            setValue(undefined)\n                            setSearchValue(undefined)\n                            setSave(false)\n                        }}\n                    >\n                        Cancel\n                    </Button>\n                    <Button\n                        disabled={!value}\n                        onClick={() => setSave(true)}\n                    >\n                        Save\n                    </Button>\n                </div>\n            </div>\n            {save && <div style={{ width: \"460px\", margin: '30px auto', border: '1px solid #ded7d7', padding: '5px' }}>\n                <h2>Folder info</h2>\n                <div>\n                    <span>{value.label}</span>\n                    <br></br>\n                    <span>{value.type === 'all' ? 'Visible to Everyone' : 'Visible to specific users'}</span>\n                    <br></br>\n                    <span>{!!value?.allowers?.length && `Visible to ${value.allowers.toString()}`}</span>\n                </div>\n            </div>}\n        </>\n    );\n}\n\nexport default SearchTree"]},"metadata":{},"sourceType":"module"}